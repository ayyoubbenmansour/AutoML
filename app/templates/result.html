{% extends "base.html" %}

{% block title %}R√©sultats du Mod√®le - AutoML Pro{% endblock %}

{% block extra_css %}
<style>
/* Page-specific styles for results page */
.success-badge {
    display: inline-block;
    background: var(--success-gradient);
    color: white;
    padding: 10px 20px;
    border-radius: 25px;
    font-size: 1.1rem;
    font-weight: var(--font-weight-semibold);
    margin-bottom: 30px;
    box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
}

.model-info {
    background: var(--accent-gradient);
    border-radius: var(--border-radius);
    padding: 30px;
    text-align: center;
    margin-bottom: 40px;
    box-shadow: 0 15px 35px rgba(79, 172, 254, 0.3);
    position: relative;
    z-index: 3;
}

.model-type {
    font-size: 2rem;
    font-weight: var(--font-weight-extrabold);
    margin-bottom: 10px;
}

.model-description {
    opacity: 0.95;
    font-size: 1.1rem;
}

.metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 40px;
}

.metric-card {
    background: var(--glass-bg-dark);
    border-radius: 15px;
    padding: 25px;
    text-align: center;
    transition: var(--transition-fast);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.metric-card:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
}

.metric-value {
    font-size: 2.5rem;
    font-weight: var(--font-weight-extrabold);
    margin-bottom: 10px;
    background: linear-gradient(45deg, #fff, #4facfe);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.metric-label {
    font-size: 1rem;
    opacity: 0.9;
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: var(--font-weight-semibold);
}

.visualization-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 30px;
    margin-bottom: 40px;
}

.visualization-card {
    background: var(--glass-bg-dark);
    border-radius: var(--border-radius);
    padding: 25px;
    text-align: center;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: var(--transition-fast);
}

.visualization-card:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
}

.visualization-card h3 {
    margin-bottom: 20px;
    font-size: 1.3rem;
    color: #4facfe;
    font-weight: var(--font-weight-bold);
}

.visualization-card img {
    max-width: 100%;
    height: auto;
    border-radius: 10px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
    transition: transform 0.3s ease;
    cursor: pointer;
}

.visualization-card img:hover {
    transform: scale(1.02);
}

.report-section {
    background: var(--glass-bg-dark);
    border-radius: 15px;
    padding: 30px;
    margin-bottom: 30px;
    border-left: 4px solid #4facfe;
    backdrop-filter: blur(10px);
}

.report-section h3 {
    color: #4facfe;
    font-size: 1.4rem;
    margin-bottom: 20px;
    font-weight: var(--font-weight-bold);
}

.report-content {
    background: rgba(0, 0, 0, 0.2);
    border-radius: 10px;
    padding: 20px;
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
    line-height: 1.6;
    white-space: pre-wrap;
    overflow-x: auto;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.navigation-section {
    display: flex;
    justify-content: center;
    gap: 20px;
    flex-wrap: wrap;
    margin-top: 40px;
}

.nav-btn {
    background: rgba(255, 255, 255, 0.15);
    color: white;
    padding: 15px 30px;
    border: none;
    border-radius: 25px;
    font-size: 1rem;
    font-weight: var(--font-weight-semibold);
    cursor: pointer;
    text-decoration: none;
    transition: var(--transition-fast);
    display: inline-flex;
    align-items: center;
    gap: 10px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.nav-btn:hover {
    background: rgba(255, 255, 255, 0.25);
    transform: translateY(-2px);
    color: white;
    text-decoration: none;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

.nav-btn.primary {
    background: var(--accent-gradient);
}

.nav-btn.primary:hover {
    background: linear-gradient(45deg, #3d8bfe, #00d4fe);
}

.nav-btn.success {
    background: var(--success-gradient);
}

.nav-btn.success:hover {
    background: linear-gradient(45deg, #45a049, #3d8b40);
}

.hpo-info {
    background: var(--warning-gradient);
    border-radius: 15px;
    padding: 25px;
    margin-bottom: 30px;
    text-align: center;
}

.hpo-info h4 {
    margin-bottom: 15px;
    font-size: 1.3rem;
}

.hpo-params {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin-top: 20px;
}

.param-item {
    background: rgba(255, 255, 255, 0.1);
    padding: 10px;
    border-radius: 8px;
    text-align: center;
}

.param-value {
    font-weight: var(--font-weight-bold);
    font-size: 1.1rem;
    margin-bottom: 5px;
}
.params-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin: 20px 0;
}

.param-card {
    background: rgba(255, 255, 255, 0.1);
    padding: 15px;
    border-radius: 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
}

.param-card .param-label {
    font-size: 0.85rem;
    opacity: 0.9;
    margin-bottom: 5px;
}

.param-card .param-value {
    font-size: 1.2rem;
    font-weight: bold;
    color: #4facfe;
}
.param-label {
    font-size: 0.85rem;
    opacity: 0.9;
}

/* Mobile responsiveness */
@media (max-width: 768px) {
    .metrics-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
    }
    
    .visualization-grid {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    .navigation-section {
        flex-direction: column;
        align-items: center;
    }
    
    .nav-btn {
        width: 100%;
        justify-content: center;
    }
}
</style>
{% endblock %}


{% block content %}

<!-- HPO Results Section (if available) -->
{% if hpo_results %}
<div class="hpo-info">
    <h4>üéØ Optimisation HPO - Meilleurs Param√®tres</h4>
    <div class="hpo-params">
        {% for param, value in hpo_results.best_params.items() %}
        <div class="param-item">
            <div class="param-value">
                {% if value is number %}
                    {{ "%.4f"|format(value) if value < 0.01 else "%.2f"|format(value) }}
                {% else %}
                    {{ value }}
                {% endif %}
            </div>
            <div class="param-label">{{ param.replace('_', ' ').title() }}</div>
        </div>
        {% endfor %}
    </div>
    
    {% if model_params %}
    <div class="model-params">
        <h3>Param√®tres appliqu√©s</h3>
        <ul>
            {% for key, value in model_params.items() %}
            <li><strong>{{ key }}:</strong> {{ value }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
    
    {% if hpo_results.best_score %}
    <div style="margin-top: 20px;">
        <span class="success-badge">
            Score Optimal: {{ "%.4f"|format(hpo_results.best_score) }}
        </span>
    </div>
    {% endif %}
    
    {% if hpo_results.n_trials %}
    <div style="margin-top: 10px; opacity: 0.9;">
        M√©thode: {{ hpo_results.optimization_method|title }} | 
        Essais: {{ hpo_results.n_trials }}
    </div>
    {% endif %}
</div>
{% endif %}
<!-- Model Parameters for Simple/Manual Mode -->
{% if model_params %}
<div class="glass-card">
    <h3 style="margin-bottom: 20px;">‚öôÔ∏è Param√®tres du Mod√®le ({{ training_mode }})</h3>
    <div class="params-grid">
        {% for param, value in model_params.items() %}
        <div class="param-card">
            <span class="param-label">{{ param.replace('_', ' ').title() }}</span>
            <span class="param-value">
                {% if value is number %}
                    {{ "%.4f"|format(value) if value < 0.01 else value }}
                {% else %}
                    {{ value }}
                {% endif %}
            </span>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}
{% if model_params and preprocessing_config.problem_type %}
<div class="glass-card">
    <h3>
        {% if preprocessing_config.problem_type == 'classification' %}
            üß™ Classification
        {% elif preprocessing_config.problem_type == 'regression' %}
            üìà R√©gression
        {% elif preprocessing_config.problem_type == 'forecasting' %}
            üîÆ Pr√©vision Multi-Pas
        {% endif %}
    </h3>
    <div class="params-grid">
        <div class="param-card">
            <span class="param-label">Type de Probl√®me</span>
            <span class="param-value">
                {% if preprocessing_config.problem_type == 'classification' %}
                    Classification
                {% elif preprocessing_config.problem_type == 'regression' %}
                    R√©gression
                {% elif preprocessing_config.problem_type == 'forecasting' %}
                    Forecasting
                {% endif %}
            </span>
        </div>
        {% if preprocessing_config.problem_type == 'forecasting' %}
        <div class="param-card">
            <span class="param-label">Pas √† pr√©dire</span>
            <span class="param-value">{{ preprocessing_config.forecasting_steps }}</span>
        </div>
        {% endif %}
    </div>
</div>
{% endif %}

{% if additional_plots["confusion_matrix"] %}
<div class="visualization-card">
<h3>üéØ Matrice de Confusion</h3>
<img src="{{ url_for('static', filename=additional_plots["confusion_matrix"]) }}" alt="Matrice de Confusion">
</div>
{% endif %}


{% if additional_plots["roc_curve"] %}
<div class="visualization-card">
<h3>üìä Courbe ROC</h3>
<img src="{{ url_for('static', filename=additional_plots["roc_curve"]) }}" alt="Courbe ROC">
</div>
{% endif %}


{% if additional_plots["precision_recall"] %}
<div class="visualization-card">
<h3>‚öñÔ∏è Courbe Pr√©cision-Rappel</h3>
<img src="{{ url_for('static', filename=additional_plots["precision_recall"]) }}" alt="Courbe Pr√©cision-Rappel">
</div>
{% endif %}


{% if additional_plots["training_history"] %}
<div class="visualization-card">
<h3>üìà Historique d'Entra√Ænement</h3>
<img src="{{ url_for('static', filename=additional_plots["training_history"]) }}" alt="Historique d'Entra√Ænement">
</div>
{% endif %}


{% if additional_plots["prediction_distribution"] %}
<div class="visualization-card">
<h3>üî¢ Distribution des Pr√©dictions</h3>
<img src="{{ url_for('static', filename=additional_plots["prediction_distribution"]) }}" alt="Distribution des Pr√©dictions">
</div>
{% endif %}



<!-- Classification Report -->
{% if report %}
<div class="glass-card">
<div class="report-section">
<h3>üìã Rapport de Classification D√©taill√©</h3>
<div class="report-content">{{ report }}</div>
</div>
</div>
{% endif %}
{% if model_params and preprocessing_config.problem_type == 'forecasting' %}
<div class="glass-card">
    <h3>üîÆ Pr√©vision Multi-Pas</h3>
    <div class="params-grid">
        <div class="param-card">
            <span class="param-label">Type de Probl√®me</span>
            <span class="param-value">Forecasting</span>
        </div>
        <div class="param-card">
            <span class="param-label">Pas √† pr√©dire</span>
            <span class="param-value">{{ preprocessing_config.forecasting_steps }}</span>
        </div>
    </div>
</div>
{% endif %}

<!-- Navigation -->
<div class="navigation-section">
<a href="{{ url_for('main.home') }}" class="nav-btn primary">
üè† Retour √† l'Accueil
</a>
<a href="{{ url_for('main.processing_mode') }}" class="nav-btn">
üîÑ Essayer un Autre Mod√®le
</a>
<a href="{{ url_for('main.upload') }}" class="nav-btn success">
üìÅ Nouveau Dataset
</a>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Add some interactive effects
document.addEventListener('DOMContentLoaded', function() {
    // Animate metric cards on scroll
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver(function(entries) {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.animation = 'fadeInUp 0.6s ease-out forwards';
            }
        });
    }, observerOptions);

    // Observe metric cards
    document.querySelectorAll('.metric-card').forEach(card => {
        observer.observe(card);
    });

    // Add click effect to navigation buttons
    document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
            this.style.transform = 'scale(0.95)';
            setTimeout(() => {
                this.style.transform = '';
            }, 150);
        });
    });

    // Add zoom effect to images
    document.querySelectorAll('.visualization-card img').forEach(img => {
        img.addEventListener('click', function() {
            if (this.style.position === 'fixed') {
                // Close modal
                this.style.position = '';
                this.style.top = '';
                this.style.left = '';
                this.style.width = '';
                this.style.height = '';
                this.style.zIndex = '';
                this.style.background = '';
                this.style.transform = '';
                this.style.padding = '';
                this.style.borderRadius = '';
                this.style.cursor = '';
                document.body.style.overflow = '';
            } else {
                // Open modal
                this.style.position = 'fixed';
                this.style.top = '50%';
                this.style.left = '50%';
                this.style.transform = 'translate(-50%, -50%)';
                this.style.width = 'auto';
                this.style.height = '80vh';
                this.style.zIndex = '9999';
                this.style.background = 'rgba(0,0,0,0.9)';
                this.style.padding = '20px';
                this.style.borderRadius = '10px';
                this.style.cursor = 'zoom-out';
                document.body.style.overflow = 'hidden';
            }
        });
    });

    // Add success animation to metric cards
    document.querySelectorAll('.metric-card').forEach((card, index) => {
        setTimeout(() => {
            card.style.animation = `fadeInUp 0.6s ease-out forwards`;
        }, index * 100);
    });
});
</script>
{% endblock %}